<!doctype html>
<html lang="{{ request.locale.iso_code }}">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<meta name="description" content="{{ page_description }}">
		<link rel="canonical" href="{{ canonical_url }}">
		<title>{{ page_title }}</title>
		{% comment %} all css here {% endcomment %}
		{{ 'bootstrap.css' | asset_url | stylesheet_tag }}
		{{ 'style.css' | asset_url | stylesheet_tag }}
		{{ content_for_header }}
	{% include 'pagefly-app-header' %}</head>
	<body
		id="{{ page_title | handleize }}"
		class="{{ template }} {% if template.name == 'product' %}{{ product.handle }}{% endif %} {% if template.name == 'collection' %}{{ collection.handle }}{% endif %}"
	>
		{% sections 'header-group' %}
		<main>
			{{ content_for_layout }}
		</main>
		{% sections 'footer-group' %}

		{% comment %} all js here {% endcomment %}
		<script src="{{ 'jquery.js' | asset_url }}" defer="defer"></script>
		<script src="{{ 'popper.js' | asset_url }}" defer="defer"></script>
		<script src="{{ 'bootstrap.min.js' | asset_url }}" defer="defer"></script>

		{% if template == 'product' %}
			<script src="{{ 'option_selection.js' | shopify_asset_url}}" defer="defer"></script>
			<script>
				document.addEventListener("DOMContentLoaded", function() {
					var selectCallback = function(variant) {
						if (variant) {
							if (variant.available) {
								$('#add-to-cart-btn').removeAttr('disabled').val('Add to Cart');
							} else {
								$('#add-to-cart-btn').val('Sold Out');
							}

							// Update price
							if (variant.compare_at_price > variant.price) {
								$('#variant_price').html(`
									<span class="price">${Shopify.formatMoney(variant.price, "{{ shop.money_with_currency_format }}")}</span>
									<s class="compare-price">${Shopify.formatMoney(variant.compare_at_price, "{{ shop.money_with_currency_format }}")}</s>
									
								`);
							} else {
								$('#variant_price').html(`
									<span class="price">${Shopify.formatMoney(variant.price, "{{ shop.money_with_currency_format }}")}</span>
								`);
							}
							// Update media
							if (variant.featured_media) {
								var imageUrl = variant.featured_media.preview_image.src;
								$('#product-image').attr('src', imageUrl);
							}
						} else {
							$('#add-to-cart-btn').val('Unavailable').attr('disabled', 'disabled');
						}
					};

					jQuery(function($) {
						new Shopify.OptionSelectors('variant_select', {
							product: {{ product | json }},
							onVariantSelected: selectCallback,
							enableHistoryState: true
						});
					});
				});

			</script>
		{% endif %}
	</body>
</html>
